<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGTK SULTENG - Admin Edit Biodata</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='TUT.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='TUT.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='TUT.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tambah-data.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='LOGO.png') }}" alt="BGTK Sulteng" class="sidebar-logo">
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('admin_dashboard') }}" class="sidebar-link">
                    <span class="sidebar-icon icon-dashboard" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 3h8v8H3V3zm10 0h8v5h-8V3zm0 7h8v11h-8V10zM3 13h8v8H3v-8z"/>
                        </svg>
                    </span>
                    <div class="sidebar-link-text">
                        <span class="sidebar-title">Dashboard</span>
                    </div>
                </a>
                <a href="{{ url_for('admin_kegiatan') }}" class="sidebar-link {% if 'kegiatan' in request.path and 'edit-kegiatan' not in request.path and 'detail' not in request.path %}active{% endif %}">
                    <span class="sidebar-icon icon-kegiatan" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 3h6a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"/>
                            <path d="M9 3V2h6v1m-5 5h4m-4 4h4m-4 4h4"/>
                        </svg>
                    </span>
                    <div class="sidebar-link-text">
                        <span class="sidebar-title">Kegiatan</span>
                    </div>
                </a>
                <a href="{{ url_for('admin_rekap_filter') }}" class="sidebar-link {% if 'rekap-filter' in request.path %}active{% endif %}">
                    <span class="sidebar-icon icon-rekap" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 21s-6-4.35-6-10a6 6 0 1 1 12 0c0 5.65-6 10-6 10Z"/>
                            <circle cx="12" cy="11" r="2.2"/>
                        </svg>
                    </span>
                    <div class="sidebar-link-text">
                        <span class="sidebar-title">Rekap</span>
                    </div>
                </a>
                {% if user_role != 'operator' %}
                <a href="{{ url_for('admin_users') }}" class="sidebar-link {% if 'users' in request.path or 'edit-operator' in request.path %}active{% endif %}">
                    <span class="sidebar-icon icon-users" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/>
                            <circle cx="10" cy="8" r="4"/>
                            <path d="M21 21v-2a3 3 0 0 0-2-2.82m-3-11.65a3 3 0 0 1 0 5.94"/>
                        </svg>
                    </span>
                    <div class="sidebar-link-text">
                        <span class="sidebar-title">Operator</span>
                    </div>
                </a>
                {% endif %}
            </nav>
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="sidebar-link sidebar-link--logout">
                    <span class="sidebar-icon icon-logout" aria-hidden="true">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M15 17l5-5-5-5"/>
                            <path d="M20 12H9"/>
                            <path d="M13 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6"/>
                        </svg>
                    </span>
                    <div class="sidebar-link-text">
                        <span class="sidebar-title">Logout</span>
                    </div>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <div class="topbar-title">Selamat Datang, {{ user_display_name or 'Admin' }}!</div>
                <div class="profile-menu">
                    <button type="button" class="profile-btn" id="profileBtn">Profil</button>
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="profile-name">{{ user_display_name or 'Admin' }}</div>
                        <a href="{{ url_for('change_password') }}">Ubah Password</a>
                    </div>
                </div>
            </div>
            <div class="container">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="flash-messages" style="display: none;">
                            {% for category, message in messages %}
                                <div class="flash-message flash-{{ category }}">{{ message }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Header Section -->
                <div class="header-section">
                    <div class="header-content">
                        <div class="logo-container">
                            <div class="logo">
                                <img src="{{ url_for('static', filename='TUT.png') }}" alt="Logo TUT">
                            </div>
                        </div>
                        <div class="institution-info">
                            <h2>KEMENTERIAN PENDIDIKAN DASAR DAN MENENGAH</h2>
                            <h3>BALAI GURU DAN TENAGA KEPENDIDIKAN PROVINSI SULAWESI TENGAH</h3>
                            <p>Jl. Tolambu No.12 Kamonji, Kec. Palu Barat, Kota Palu, Sulawesi Tengah 94223</p>
                            <p>bgtksulteng.kemendikdasmen.go.id</p>
                        </div>
                    </div>
                    <hr class="divider">
                    <h1 class="form-title">EDIT BIODATA KEGIATAN BGTK PROVINSI SULAWESI TENGAH TAHUN {{ current_year|default(2025) }}</h1>
                    <p style="text-align: center; color: #666; margin-top: 10px;">
                        <strong>NIK:</strong> {{ nik }} | <strong>Kegiatan:</strong> {{ nama_kegiatan }}
                    </p>
                </div>

                <!-- Form Section -->
                <div class="form-section">
                    <form method="POST" action="{{ url_for('admin_edit_biodata', nik=nik, nama_kegiatan=nama_kegiatan) }}" class="biodata-form" id="editBiodataForm" enctype="multipart/form-data" autocomplete="off">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        {% if from_page %}
                        <input type="hidden" name="from_page" value="{{ from_page }}"/>
                        {% endif %}

                        <div class="form-group">
                            <label for="nama_kegiatan">Nama Kegiatan <span class="required">*</span></label>
                            <select id="nama_kegiatan" name="nama_kegiatan" class="form-select" required>
                                <option value="" disabled>-Select-</option>
                                {% if kegiatan_list %}
                                    {% for kegiatan in kegiatan_list %}
                                        <option value="{{ kegiatan.nama_kegiatan }}" {% if biodata and biodata.nama_kegiatan == kegiatan.nama_kegiatan %}selected{% endif %}>{{ kegiatan.nama_kegiatan }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="waktu_pelaksanaan">Waktu Pelaksanaan<span class="required">*</span></label>
                            <input type="text" id="waktu_pelaksanaan" name="waktu_pelaksanaan" class="form-input" placeholder="Pilih nama kegiatan terlebih dahulu" value="{{ biodata.waktu_pelaksanaan if biodata else '' }}" readonly required>
                        </div>

                        <div class="form-group">
                            <label for="tempat_pelaksanaan">Tempat Pelaksanaan<span class="required">*</span></label>
                            <input type="text" id="tempat_pelaksanaan" name="tempat_pelaksanaan" class="form-input" placeholder="Pilih nama kegiatan terlebih dahulu" value="{{ biodata.tempat_pelaksanaan if biodata else '' }}" readonly required>
                        </div>
                        
                        <div class="form-group">
                            <label for="peran">Peran Dalam Kegiatan <span class="required">*</span></label>
                            <select id="peran" name="peran" class="form-select" required>
                                <option value="" disabled selected>-Select-</option>
                                <option value="Narasumber" {% if biodata and biodata.peran == 'Narasumber' %}selected{% endif %}>Narasumber</option>
                                <option value="Fasilitator/Narasumber" {% if biodata and biodata.peran == 'Fasilitator/Narasumber' %}selected{% endif %}>Fasilitator/Narasumber</option>
                                <option value="Pengajar PM" {% if biodata and biodata.peran == 'Pengajar PM' %}selected{% endif %}>Pengajar PM</option>
                                <option value="Penceramah" {% if biodata and biodata.peran == 'Penceramah' %}selected{% endif %}>Penceramah</option>
                                <option value="Panitia BGTK" {% if biodata and biodata.peran == 'Panitia BGTK' %}selected{% endif %}>Panitia BGTK</option>
                                <option value="Panitia Daerah" {% if biodata and biodata.peran == 'Panitia Daerah' %}selected{% endif %}>Panitia Daerah</option>
                                <option value="Panitia Sekolah" {% if biodata and biodata.peran == 'Panitia Sekolah' %}selected{% endif %}>Panitia Sekolah</option>
                                <option value="Peserta Kegiatan" {% if biodata and biodata.peran == 'Peserta Kegiatan' %}selected{% endif %}>Peserta Kegiatan</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="nama_lengkap">Nama Lengkap <span class="required">*</span></label>
                            <input type="text" id="nama_lengkap" name="nama_lengkap" class="form-input" placeholder="Masukkan nama lengkap" pattern="[^0-9]+" title="Tidak boleh mengandung angka" value="{{ biodata.nama_lengkap if biodata else '' }}" required>
                        </div>

                         <div class="form-group">
                            <label for="NIK">NIK<span class="required">*</span></label>
                            <input type="text" id="NIK" name="NIK" class="form-input" placeholder="Masukkan NIK (16 digit)" inputmode="numeric" pattern="[0-9]{16}" title="NIK harus tepat 16 digit angka" maxlength="16" value="{{ biodata.nik if biodata else '' }}" required oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 16)">
                            <div id="nik-feedback" class="nik-feedback" style="display: none; margin-top: 5px; font-size: 14px;"></div>
                        </div>

                        <div class="form-group">
                            <label for="nip_nippk">NIP/NIPPK <span class="required">*</span></label>
                            <small style="display: block; color: #666; font-size: 12px; margin-bottom: 5px;">Jika Non ASN, isi dengan 0 sebanyak 18 digit (000000000000000000)</small>
                            <input type="text" id="nip_nippk" name="nip/nippk" class="form-input" placeholder="Masukkan NIP/NIPPK (18 digit)" inputmode="numeric" pattern="^\d{18}$" title="NIP/NIPPK harus tepat 18 digit angka. Jika Non ASN, isi dengan 0 sebanyak 18 digit (000000000000000000)" maxlength="18" autocomplete="off" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 18);" value="{{ biodata.nip_nippk if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="tempat_lahir">Tempat Lahir<span class="required">*</span></label>
                            <input type="text" id="tempat_lahir" name="tempat_lahir" class="form-input" placeholder="Masukkan Tempat Lahir" pattern="[^0-9]+" title="Tidak boleh mengandung angka" value="{{ biodata.tempat_lahir if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="tanggal_lahir">Tanggal Lahir<span class="required">*</span></label>
                             <input type="date" id="tanggal_lahir" name="tanggal_lahir" class="form-input" value="{{ biodata.tanggal_lahir if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="jenis_kelamin">Jenis Kelamin <span class="required">*</span></label>
                            <div class="radio-pills" role="radiogroup" aria-label="Jenis Kelamin">
                                <div class="radio-pill">
                                    <input
                                        type="radio"
                                        id="jk_laki_admin"
                                        name="jenis_kelamin"
                                        value="Laki-laki"
                                        {% if biodata and biodata.jenis_kelamin == 'Laki-laki' %}checked{% endif %}
                                        {% if not biodata or not biodata.jenis_kelamin %}required{% endif %}
                                    >
                                    <label for="jk_laki_admin">Laki-laki</label>
                                </div>
                                <div class="radio-pill">
                                    <input
                                        type="radio"
                                        id="jk_perempuan_admin"
                                        name="jenis_kelamin"
                                        value="Perempuan"
                                        {% if biodata and biodata.jenis_kelamin == 'Perempuan' %}checked{% endif %}
                                    >
                                    <label for="jk_perempuan_admin">Perempuan</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="agama">Agama <span class="required">*</span></label>
                            <select id="agama" name="agama" class="form-select" required>
                                <option value="" disabled {% if not biodata or not biodata.agama %}selected{% endif %}>-Select-</option>
                                <option value="Islam" {% if biodata and biodata.agama == 'Islam' %}selected{% endif %}>Islam</option>
                                <option value="Kristen" {% if biodata and biodata.agama == 'Kristen' %}selected{% endif %}>Kristen</option>
                                <option value="Katolik" {% if biodata and biodata.agama == 'Katolik' %}selected{% endif %}>Katolik</option>
                                <option value="Hindu" {% if biodata and biodata.agama == 'Hindu' %}selected{% endif %}>Hindu</option>
                                <option value="Budha" {% if biodata and biodata.agama == 'Budha' %}selected{% endif %}>Budha</option>
                                <option value="Konghucu" {% if biodata and biodata.agama == 'Konghucu' %}selected{% endif %}>Konghucu</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pendidikan_terakhir">Pendidikan Terakhir <span class="required">*</span></label>
                            <select id="pendidikan_terakhir" name="pendidikan_terakhir" class="form-select" required>
                                <option value="" disabled {% if not biodata or not biodata.pendidikan_terakhir %}selected{% endif %}>-Select-</option>
                                <option value="SMA/SMK" {% if biodata and biodata.pendidikan_terakhir == 'SMA/SMK' %}selected{% endif %}>SMA/SMK</option>
                                <option value="D1/D2" {% if biodata and biodata.pendidikan_terakhir == 'D1/D2' %}selected{% endif %}>D1/D2</option>
                                <option value="D3" {% if biodata and biodata.pendidikan_terakhir == 'D3' %}selected{% endif %}>D3</option>
                                <option value="S1/D4" {% if biodata and biodata.pendidikan_terakhir == 'S1/D4' %}selected{% endif %}>S1/D4</option>
                                <option value="S2" {% if biodata and biodata.pendidikan_terakhir == 'S2' %}selected{% endif %}>S2</option>
                                <option value="S3" {% if biodata and biodata.pendidikan_terakhir == 'S3' %}selected{% endif %}>S3</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="jurusan">Jurusan<span class="required">*</span></label>
                            <input type="text" id="jurusan" name="jurusan" class="form-input" placeholder="Masukkan Jurusan" value="{{ biodata.jurusan if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="alamat_domisili">Alamat Domisili<span class="required">*</span></label>
                            <input type="text" id="alamat_domisili" name="alamat_domisili" class="form-input" placeholder="Masukkan Alamat Domisili" value="{{ biodata.alamat_domisili if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="alamat_email">Alamat Email<span class="required">*</span></label>
                            <input type="email" id="alamat_email" name="alamat_email" class="form-input" placeholder="Masukkan Alamat Email" value="{{ biodata.alamat_email if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="no_hp">Nomor HP/TLP/WA<span class="required">*</span></label>
                            <input type="tel" id="no_hp" name="nohp" class="form-input" placeholder="Masukkan Nomor HP/TLP/WA" inputmode="numeric" pattern="[0-9]+" title="Masukkan angka saja" value="{{ biodata.no_hp if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="npwp">NPWP<span class="required">*</span></label>
                            <input type="text" id="npwp" name="npwp" class="form-input" placeholder="Masukkan NPWP" value="{{ biodata.npwp if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="status_asn">Status ASN <span class="required">*</span></label>
                            <select id="status_asn" name="status_asn" class="form-select" required>
                                <option value="" disabled {% if not biodata or not biodata.status_asn %}selected{% endif %}>-Select-</option>
                                <option value="PNS" {% if biodata and biodata.status_asn == 'PNS' %}selected{% endif %}>PNS</option>
                                <option value="PPPK" {% if biodata and biodata.status_asn == 'PPPK' %}selected{% endif %}>PPPK</option>
                                <option value="Non ASN" {% if biodata and biodata.status_asn == 'Non ASN' %}selected{% endif %}>Non ASN</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pangkat_golongan">Pangkat/Golongan <span class="required">*</span></label>
                            <select id="pangkat_golongan" name="Pangkat/Golongan" class="form-select" required>
                                <option value="" disabled selected>-Select-</option>
                                <option value="Pengatur Muda, II/a" {% if biodata and biodata.pangkat_golongan == 'Pengatur Muda, II/a' %}selected{% endif %}>Pengatur Muda, II/a</option>
                                <option value="Pengatur Muda Tkt.I, II/b" {% if biodata and biodata.pangkat_golongan == 'Pengatur Muda Tkt.I, II/b' %}selected{% endif %}>Pengatur Muda Tkt.I, II/b</option>
                                <option value="Pengatur, II/c" {% if biodata and biodata.pangkat_golongan == 'Pengatur, II/c' %}selected{% endif %}>Pengatur, II/c</option>
                                <option value="Pengatur Tkt.I, II/d" {% if biodata and biodata.pangkat_golongan == 'Pengatur Tkt.I, II/d' %}selected{% endif %}>Pengatur Tkt.I, II/d</option>
                                <option value="Penata Muda, III/a" {% if biodata and biodata.pangkat_golongan == 'Penata Muda, III/a' %}selected{% endif %}>Penata Muda, III/a</option>
                                <option value="Penata Muda Tkt.I, III/b" {% if biodata and biodata.pangkat_golongan == 'Penata Muda Tkt.I, III/b' %}selected{% endif %}>Penata Muda Tkt.I, III/b</option>
                                <option value="Penata, III/c" {% if biodata and biodata.pangkat_golongan == 'Penata, III/c' %}selected{% endif %}>Penata, III/c</option>
                                <option value="Penata Tkt.I, III/d" {% if biodata and biodata.pangkat_golongan == 'Penata Tkt.I, III/d' %}selected{% endif %}>Penata Tkt.I, III/d</option>
                                <option value="Pembina, IV/a" {% if biodata and biodata.pangkat_golongan == 'Pembina, IV/a' %}selected{% endif %}>Pembina, IV/a</option>
                                <option value="Pembina Tkt.I, IV/b" {% if biodata and biodata.pangkat_golongan == 'Pembina Tkt.I, IV/b' %}selected{% endif %}>Pembina Tkt.I, IV/b</option>
                                <option value="Pembina Utama Muda, IV/c" {% if biodata and biodata.pangkat_golongan == 'Pembina Utama Muda, IV/c' %}selected{% endif %}>Pembina Utama Muda, IV/c</option>
                                <option value="Pembina Utama Madya, IV/d" {% if biodata and biodata.pangkat_golongan == 'Pembina Utama Madya, IV/d' %}selected{% endif %}>Pembina Utama Madya, IV/d</option>
                                <option value="PPPK Gol. IX" {% if biodata and biodata.pangkat_golongan == 'PPPK Gol. IX' %}selected{% endif %}>PPPK Gol. IX</option>
                                <option value="PPPK Gol. X" {% if biodata and biodata.pangkat_golongan == 'PPPK Gol. X' %}selected{% endif %}>PPPK Gol. X</option>
                                <option value="PPPK Gol. VII" {% if biodata and biodata.pangkat_golongan == 'PPPK Gol. VII' %}selected{% endif %}>PPPK Gol. VII</option>
                                <option value="PPPK Gol. VI" {% if biodata and biodata.pangkat_golongan == 'PPPK Gol. VI' %}selected{% endif %}>PPPK Gol. VI</option>
                                <option value="PPPK Gol. V" {% if biodata and biodata.pangkat_golongan == 'PPPK Gol. V' %}selected{% endif %}>PPPK Gol. V</option>
                                <option value="Non ASN" {% if biodata and biodata.pangkat_golongan == 'Non ASN' %}selected{% endif %}>Non ASN</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="jabatan">Jabatan<span class="required">*</span></label>
                            <input type="text" id="jabatan" name="jabatan" class="form-input" placeholder="Masukkan Jabatan" value="{{ biodata.jabatan if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="instansi">Instansi<span class="required">*</span></label>
                            <input type="text" id="instansi" name="instansi" class="form-input" placeholder="Masukkan Instansi" value="{{ biodata.instansi if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="alamat_instansi">Alamat Instansi<span class="required">*</span></label>
                            <input type="text" id="alamat_instansi" name="alamat_instansi" class="form-input" placeholder="Masukkan Alamat Instansi" value="{{ biodata.alamat_instansi if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="kabupaten_kota">Kabupaten/Kota<span class="required">*</span></label>
                            <select id="kabupaten_kota" name="kabupaten/kota" class="form-select" required>
                                <option value="" disabled selected>-Select-</option>
                                <option value="BANGGAI" {% if biodata and biodata.kabupaten_kota == 'BANGGAI' %}selected{% endif %}>BANGGAI</option>
                                <option value="BANGGAI KEPULAUAN" {% if biodata and biodata.kabupaten_kota == 'BANGGAI KEPULAUAN' %}selected{% endif %}>BANGGAI KEPULAUAN</option>
                                <option value="BANGGAI LAUT" {% if biodata and biodata.kabupaten_kota == 'BANGGAI LAUT' %}selected{% endif %}>BANGGAI LAUT</option>
                                <option value="BUOL" {% if biodata and biodata.kabupaten_kota == 'BUOL' %}selected{% endif %}>BUOL</option>
                                <option value="DONGGALA" {% if biodata and biodata.kabupaten_kota == 'DONGGALA' %}selected{% endif %}>DONGGALA</option>
                                <option value="MOROWALI" {% if biodata and biodata.kabupaten_kota == 'MOROWALI' %}selected{% endif %}>MOROWALI</option>
                                <option value="MOROWALI UTARA" {% if biodata and biodata.kabupaten_kota == 'MOROWALI UTARA' %}selected{% endif %}>MOROWALI UTARA</option>
                                <option value="PALU" {% if biodata and biodata.kabupaten_kota == 'PALU' %}selected{% endif %}>PALU</option>
                                <option value="PARIGI MOUTONG" {% if biodata and biodata.kabupaten_kota == 'PARIGI MOUTONG' %}selected{% endif %}>PARIGI MOUTONG</option>
                                <option value="POSO" {% if biodata and biodata.kabupaten_kota == 'POSO' %}selected{% endif %}>POSO</option>
                                <option value="SIGI" {% if biodata and biodata.kabupaten_kota == 'SIGI' %}selected{% endif %}>SIGI</option>
                                <option value="TOJO UNA-UNA" {% if biodata and biodata.kabupaten_kota == 'TOJO UNA-UNA' %}selected{% endif %}>TOJO UNA-UNA</option>
                                <option value="TOLI-TOLI" {% if biodata and biodata.kabupaten_kota == 'TOLI-TOLI' %}selected{% endif %}>TOLI-TOLI</option>
                                <option value="LAINNYA" {% if biodata and biodata.kabupaten_kota == 'LAINNYA' %}selected{% endif %}>LAINNYA</option>
                            </select>
                        </div>

                        <div class="form-group" id="kabko-lainnya-group" style="display: none;">
                            <label for="kabko_lainnya">Nama Kabupaten/Kota diluar Sulawesi Tengah<span class="required">*</span></label>
                            <input type="text" id="kabko_lainnya" name="kabko_lainnya" class="form-input" placeholder="Masukkan Nama Kabupaten/Kota Diluar Sulawesi Tengah" value="{{ biodata.kabko_lainnya if biodata else '' }}">
                        </div>

                        <div class="form-group">
                            <label for="nama_bank">Nama Bank<span class="required">*</span></label>
                            <select id="nama_bank" name="nama_bank" class="form-select" required>
                                <option value="" disabled selected>-Select-</option>
                                <option value="BANK BSI" {% if biodata and biodata.nama_bank == 'BANK BSI' %}selected{% endif %}>BANK BSI</option>
                                <option value="BANK MANDIRI" {% if biodata and biodata.nama_bank == 'BANK MANDIRI' %}selected{% endif %}>BANK MANDIRI</option>
                                <option value="BANK BNI" {% if biodata and biodata.nama_bank == 'BANK BNI' %}selected{% endif %}>BANK BNI</option>
                                <option value="BANK BRI" {% if biodata and biodata.nama_bank == 'BANK BRI' %}selected{% endif %}>BANK BRI</option>
                                <option value="BANK SULTENG" {% if biodata and biodata.nama_bank == 'BANK SULTENG' %}selected{% endif %}>BANK SULTENG</option>
                                <option value="BANK BCA" {% if biodata and biodata.nama_bank == 'BANK BCA' %}selected{% endif %}>BANK BCA</option>
                                <option value="BANK MUAMALAT" {% if biodata and biodata.nama_bank == 'BANK MUAMALAT' %}selected{% endif %}>BANK MUAMALAT</option>
                                <option value="BANK LAINNYA" {% if biodata and biodata.nama_bank == 'BANK LAINNYA' %}selected{% endif %}>BANK LAINNYA</option>
                            </select>
                        </div>

                         <div class="form-group" id="bank-lainnya-group" style="display: none;">
                             <label for="nama_bank_lainnya">Nama Bank Lainnya<span class="required">*</span></label>
                             <input type="text" id="nama_bank_lainnya" name="nama_bank_lainnya" class="form-input" placeholder="Masukkan Nama Bank Lainnya" value="{{ biodata.nama_bank_lainnya if biodata else '' }}">
                         </div>

                        <div class="form-group">
                            <label for="no_rekening">No. Rekening<span class="required">*</span></label>
                            <input type="text" id="no_rekening" name="no_rekening" class="form-input" placeholder="Masukkan No. Rekening" inputmode="numeric" pattern="[0-9]+" title="Masukkan angka saja" value="{{ biodata.no_rekening if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="nama_pemilik_rekening">Nama Pemilik Rekening<span class="required">*</span></label>
                            <input type="text" id="nama_pemilik_rekening" name="nama_pemilik_rekening" class="form-input" placeholder="Masukkan Nama Pemilik Rekening" pattern="[^0-9]+" title="Tidak boleh mengandung angka" value="{{ biodata.nama_pemilik_rekening if biodata else '' }}" required>
                        </div>

                        <div class="form-group">
                            <label for="buku_tabungan">Foto Buku Tabungan atau Tangkapan Layar Rekening Bank dari Aplikasi Mobile Banking</label>
                            <div class="file-upload-wrapper">
                                <input type="file" id="buku_tabungan" name="buku_tabungan" class="file-upload-input" accept="image/*">
                                <label for="buku_tabungan" class="file-upload-label">
                                    <span id="buku_tabungan_text">Choose File</span>
                                    <div class="file-upload-icons">
                                        <span class="icon upload">&#8682;</span>
                                    </div>
                                </label>
                            </div>
                            <div id="buku_tabungan_preview" class="image-preview" style="display: none;">
                                <span class="image-preview-label">Preview: Klik gambar untuk memperbesar</span>
                                <img id="buku_tabungan_img" src="" alt="Preview Foto Buku Tabungan">
                            </div>
                            {% if biodata and biodata.buku_tabungan_path %}
                            <div class="image-preview existing-image" style="margin-top: 10px;">
                                <p style="font-size: 12px; color: #666; margin-bottom: 5px;">Foto saat ini:</p>
                                <span class="image-preview-label" style="display: block; margin-bottom: 8px;">Klik gambar untuk memperbesar</span>
                                {% if 'uploads/' in biodata.buku_tabungan_path %}
                                    {% set img_path = biodata.buku_tabungan_path %}
                                {% else %}
                                    {% set img_path = 'uploads/' + biodata.buku_tabungan_path %}
                                {% endif %}
                                <img src="{{ url_for('static', filename=img_path) }}" alt="Foto Buku Tabungan" id="existing_buku_tabungan_img" onerror="this.style.display='none'; this.parentElement.querySelector('p').textContent='Foto tidak ditemukan';">
                            </div>
                            {% endif %}
                        </div>

                        <div class="form-group signature-group">
                            <label for="ttd_canvas">Tanda Tangan<span class="required">*</span></label>
                            <div class="signature-pad">
                                <canvas id="ttd_canvas" width="800" height="200"></canvas>
                            </div>
                            <div class="signature-actions">
                                <button type="button" id="clear_signature" class="btn-link">Clear</button>
                            </div>
                            <input type="hidden" id="ttd" name="ttd" required>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Update Data</button>
                            <a href="{{ url_for('admin_detail_kegiatan', nama_kegiatan=nama_kegiatan) }}" class="btn btn-secondary">Kembali</a>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
     <script>
         document.addEventListener('DOMContentLoaded', function () {
            // Validasi NIK real-time (untuk admin, tidak perlu cek duplikasi karena admin bisa edit semua)
            const nikInput = document.getElementById('NIK');
            const nikFeedback = document.getElementById('nik-feedback');

            nikInput.addEventListener('input', function() {
                // Hapus semua karakter non-digit dan batasi 16 digit
                let nik = this.value.replace(/[^0-9]/g, '').slice(0, 16);
                this.value = nik;
                nik = nik.trim();

                // Validasi panjang NIK
                if (nik.length > 16) {
                    this.value = nik.substring(0, 16);
                    nik = nik.substring(0, 16);
                }

                if (nik.length > 0 && nik.length < 16) {
                    nikFeedback.style.display = 'block';
                    nikFeedback.textContent = '⚠ NIK harus 16 digit (' + nik.length + '/16)';
                    nikFeedback.className = 'nik-feedback unavailable';
                    nikInput.setCustomValidity('NIK harus tepat 16 digit');
                } else if (nik.length === 16 && !/^\d{16}$/.test(nik)) {
                    nikFeedback.style.display = 'block';
                    nikFeedback.textContent = '✗ NIK harus berupa angka';
                    nikFeedback.className = 'nik-feedback unavailable';
                    nikInput.setCustomValidity('NIK harus berupa angka');
                } else if (nik.length === 16) {
                    nikFeedback.style.display = 'block';
                    nikFeedback.textContent = '✓ NIK valid';
                    nikFeedback.className = 'nik-feedback available';
                    nikInput.setCustomValidity('');
                } else {
                    nikFeedback.style.display = 'none';
                    nikInput.setCustomValidity('');
                }
            });

            const namaBankSelect = document.getElementById('nama_bank');
            const bankLainnyaGroup = document.getElementById('bank-lainnya-group');
            const namaBankLainnyaInput = document.getElementById('nama_bank_lainnya');
            const kabupatenSelect = document.getElementById('kabupaten_kota');
            const kabkoLainnyaGroup = document.getElementById('kabko-lainnya-group');
            const kabkoLainnyaInput = document.getElementById('kabko_lainnya');

            function toggleGroup(selectElement, groupElement, inputElement, targetValue) {
                const selectedOption = selectElement.options[selectElement.selectedIndex];
                const selectedValue = selectedOption ? selectedOption.value.trim().toUpperCase() : '';
                const shouldShow = selectedValue === targetValue;
                groupElement.style.display = shouldShow ? 'block' : 'none';
                inputElement.required = shouldShow;
                if (!shouldShow) {
                    inputElement.value = '';
                }
            }

            namaBankSelect.addEventListener('change', function () {
                toggleGroup(namaBankSelect, bankLainnyaGroup, namaBankLainnyaInput, 'BANK LAINNYA');
            });

            kabupatenSelect.addEventListener('change', function () {
                toggleGroup(kabupatenSelect, kabkoLainnyaGroup, kabkoLainnyaInput, 'LAINNYA');
            });

            // Initialize toggle groups based on existing data
            toggleGroup(namaBankSelect, bankLainnyaGroup, namaBankLainnyaInput, 'BANK LAINNYA');
            toggleGroup(kabupatenSelect, kabkoLainnyaGroup, kabkoLainnyaInput, 'LAINNYA');

            const bukuTabunganInput = document.getElementById('buku_tabungan');
            const bukuTabunganText = document.getElementById('buku_tabungan_text');
            const bukuTabunganPreview = document.getElementById('buku_tabungan_preview');
            const bukuTabunganImg = document.getElementById('buku_tabungan_img');
            const existingBukuTabunganImg = document.getElementById('existing_buku_tabungan_img');

            // Buat modal untuk preview gambar
            let imageModal = document.getElementById('imageModal');
            if (!imageModal) {
                imageModal = document.createElement('div');
                imageModal.id = 'imageModal';
                imageModal.className = 'image-modal';
                imageModal.innerHTML = `
                    <div class="image-modal-content">
                        <span class="image-modal-close">&times;</span>
                        <img id="modalImage" src="" alt="Preview Gambar">
                    </div>
                `;
                document.body.appendChild(imageModal);
            }

            const modalImage = document.getElementById('modalImage');
            const modalClose = imageModal.querySelector('.image-modal-close');

            // Fungsi untuk membuka modal
            function openImageModal(imgSrc) {
                modalImage.src = imgSrc;
                imageModal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            // Fungsi untuk menutup modal
            function closeImageModal() {
                imageModal.classList.remove('show');
                document.body.style.overflow = '';
            }

            // Event listener untuk membuka modal saat klik gambar preview
            bukuTabunganImg.addEventListener('click', function() {
                if (this.src) {
                    openImageModal(this.src);
                }
            });

            // Event listener untuk membuka modal saat klik gambar existing
            if (existingBukuTabunganImg) {
                existingBukuTabunganImg.addEventListener('click', function() {
                    if (this.src) {
                        openImageModal(this.src);
                    }
                });
            }

            // Event listener untuk menutup modal
            modalClose.addEventListener('click', closeImageModal);
            imageModal.addEventListener('click', function(e) {
                if (e.target === imageModal) {
                    closeImageModal();
                }
            });

            // Tutup modal dengan tombol ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && imageModal.classList.contains('show')) {
                    closeImageModal();
                }
            });

            bukuTabunganInput.addEventListener('change', function () {
                if (bukuTabunganInput.files && bukuTabunganInput.files.length > 0) {
                    const file = bukuTabunganInput.files[0];
                    bukuTabunganText.textContent = file.name;

                    // Tampilkan preview image
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        bukuTabunganImg.src = e.target.result;
                        bukuTabunganPreview.style.display = 'block';

                        // Tambahkan style cursor pointer dan title
                        bukuTabunganImg.style.cursor = 'pointer';
                        bukuTabunganImg.title = 'Klik untuk memperbesar';

                        // Sembunyikan foto lama jika ada
                        if (existingBukuTabunganImg && existingBukuTabunganImg.parentElement) {
                            existingBukuTabunganImg.parentElement.style.display = 'none';
                        }
                    };
                    reader.readAsDataURL(file);
                } else {
                    bukuTabunganText.textContent = 'Choose File';
                    bukuTabunganPreview.style.display = 'none';

                    // Tampilkan kembali foto lama jika ada
                    if (existingBukuTabunganImg && existingBukuTabunganImg.parentElement) {
                        existingBukuTabunganImg.parentElement.style.display = 'block';
                    }
                }
            });

            // Pastikan gambar existing juga bisa diklik
            if (existingBukuTabunganImg) {
                existingBukuTabunganImg.style.cursor = 'pointer';
                existingBukuTabunganImg.title = 'Klik untuk memperbesar';
            }

            const canvas = document.getElementById('ttd_canvas');
            const ctx = canvas.getContext('2d');
            const signatureInput = document.getElementById('ttd');
            const clearBtn = document.getElementById('clear_signature');
            let drawing = false;

            // Set canvas background putih
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            function getPosition(event) {
                const rect = canvas.getBoundingClientRect();
                const clientX = event.touches ? event.touches[0].clientX : event.clientX;
                const clientY = event.touches ? event.touches[0].clientY : event.clientY;
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            function startDrawing(event) {
                event.preventDefault();
                drawing = true;
                ctx.beginPath();
                const pos = getPosition(event);
                ctx.moveTo(pos.x, pos.y);
            }

            function draw(event) {
                if (!drawing) return;
                event.preventDefault();
                const pos = getPosition(event);
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000000';
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                signatureInput.value = canvas.toDataURL('image/png');
            }

            function stopDrawing(event) {
                if (!drawing) return;
                event.preventDefault();
                drawing = false;
                ctx.closePath();
                signatureInput.value = canvas.toDataURL('image/png');
            }

            function clearSignature() {
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                signatureInput.value = '';
            }

            ['mousedown', 'touchstart'].forEach(evt => canvas.addEventListener(evt, startDrawing));
            ['mousemove', 'touchmove'].forEach(evt => canvas.addEventListener(evt, draw));
            ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evt => canvas.addEventListener(evt, stopDrawing));

            clearBtn.addEventListener('click', clearSignature);

            // Load existing data
            const biodataData = {
                pangkat_golongan: '{{ biodata.pangkat_golongan|default("") }}',
                kabupaten_kota: '{{ biodata.kabupaten_kota|default("") }}',
                peran: '{{ biodata.peran|default("") }}',
                nama_kegiatan: '{{ biodata.nama_kegiatan|default("") }}',
                nama_bank: '{{ biodata.nama_bank|default("") }}',
                kabko_lainnya: '{{ biodata.kabko_lainnya|default("") }}',
                nama_bank_lainnya: '{{ biodata.nama_bank_lainnya|default("") }}',
                tanda_tangan: '{% if biodata.tanda_tangan %}{% if "uploads/" in biodata.tanda_tangan or biodata.tanda_tangan.startswith("static/") %}{{ url_for("static", filename=biodata.tanda_tangan) }}{% else %}{{ biodata.tanda_tangan|e }}{% endif %}{% endif %}'
            };

            // Set pangkat/golongan
            if (biodataData.pangkat_golongan) {
                document.getElementById('pangkat_golongan').value = biodataData.pangkat_golongan;
            }

            // Set kabupaten/kota
            if (biodataData.kabupaten_kota) {
                kabupatenSelect.value = biodataData.kabupaten_kota;
                if (biodataData.kabupaten_kota === 'LAINNYA' && biodataData.kabko_lainnya) {
                    kabkoLainnyaInput.value = biodataData.kabko_lainnya;
                    toggleGroup(kabupatenSelect, kabkoLainnyaGroup, kabkoLainnyaInput, 'LAINNYA');
                }
            }

            // Set nama kegiatan
            if (biodataData.nama_kegiatan) {
                document.getElementById('nama_kegiatan').value = biodataData.nama_kegiatan;
            }

            // Set peran
            if (biodataData.peran) {
                document.getElementById('peran').value = biodataData.peran;
            }

            // Set nama bank
            if (biodataData.nama_bank) {
                namaBankSelect.value = biodataData.nama_bank;
                if (biodataData.nama_bank === 'BANK LAINNYA' && biodataData.nama_bank_lainnya) {
                    namaBankLainnyaInput.value = biodataData.nama_bank_lainnya;
                    toggleGroup(namaBankSelect, bankLainnyaGroup, namaBankLainnyaInput, 'BANK LAINNYA');
                }
            }

            // Load tanda tangan jika ada
            if (biodataData.tanda_tangan) {
                // Convert path file menjadi URL lengkap jika perlu
                let tandaTanganSrc = biodataData.tanda_tangan;
                if (tandaTanganSrc && (tandaTanganSrc.includes('uploads/') || tandaTanganSrc.startsWith('static/'))) {
                    // Jika path file, ubah menjadi URL lengkap
                    if (!tandaTanganSrc.startsWith('http') && !tandaTanganSrc.startsWith('/static')) {
                        tandaTanganSrc = '/static/' + tandaTanganSrc.replace('static/', '');
                    }
                }

                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    // Clear canvas dengan background putih
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    // Draw image
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    // Update input dengan base64 dari canvas
                    signatureInput.value = canvas.toDataURL('image/png');
                };
                img.onerror = function() {
                    console.error('Error loading signature image:', tandaTanganSrc);
                };
                img.src = tandaTanganSrc;
            }

            // Auto-fill waktu dan tempat pelaksanaan berdasarkan nama kegiatan
            const namaKegiatanSelect = document.getElementById('nama_kegiatan');
            const waktuPelaksanaanInput = document.getElementById('waktu_pelaksanaan');
            const tempatPelaksanaanInput = document.getElementById('tempat_pelaksanaan');

            function fillKegiatanData(namaKegiatan) {
                if (namaKegiatan) {
                    fetch(`/api/get-kegiatan/${encodeURIComponent(namaKegiatan)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.data) {
                                waktuPelaksanaanInput.value = data.data.waktu_pelaksanaan;
                                tempatPelaksanaanInput.value = data.data.tempat_pelaksanaan;
                            } else {
                                waktuPelaksanaanInput.value = '';
                                tempatPelaksanaanInput.value = '';
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching kegiatan:', error);
                            waktuPelaksanaanInput.value = '';
                            tempatPelaksanaanInput.value = '';
                        });
                } else {
                    waktuPelaksanaanInput.value = '';
                    tempatPelaksanaanInput.value = '';
                }
            }

            // Auto-fill saat user mengubah pilihan
            namaKegiatanSelect.addEventListener('change', function() {
                fillKegiatanData(this.value);
            });

            // Load data saat pertama kali
            if (biodataData.nama_kegiatan) {
                fillKegiatanData(biodataData.nama_kegiatan);
            }

            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    profileDropdown.classList.toggle('show');
                });

                document.addEventListener('click', function(event) {
                    if (!profileDropdown.contains(event.target) && event.target !== profileBtn) {
                        profileDropdown.classList.remove('show');
                    }
                });
            }

            // Filter Pangkat/Golongan berdasarkan Status ASN
            const statusAsnSelect = document.getElementById('status_asn');
            const pangkatGolonganSelect = document.getElementById('pangkat_golongan');

            if (statusAsnSelect && pangkatGolonganSelect) {
                // Simpan semua opsi asli (clone untuk menghindari masalah DOM)
                const allOptionsData = Array.from(pangkatGolonganSelect.options).map(opt => ({
                    value: opt.value,
                    text: opt.text,
                    selected: opt.selected
                }));

                // Opsi PNS (dari Pengatur Muda, II/a sampai Pembina Utama Madya, IV/d)
                const pnsOptions = [
                    'Pengatur Muda, II/a',
                    'Pengatur Muda Tkt.I, II/b',
                    'Pengatur, II/c',
                    'Pengatur Tkt.I, II/d',
                    'Penata Muda, III/a',
                    'Penata Muda Tkt.I, III/b',
                    'Penata, III/c',
                    'Penata Tkt.I, III/d',
                    'Pembina, IV/a',
                    'Pembina Tkt.I, IV/b',
                    'Pembina Utama Muda, IV/c',
                    'Pembina Utama Madya, IV/d'
                ];

                function filterPangkatGolongan() {
                    const selectedStatus = statusAsnSelect.value;
                    const currentValue = pangkatGolonganSelect.value;

                    // Hapus semua opsi kecuali opsi pertama (placeholder)
                    while (pangkatGolonganSelect.options.length > 1) {
                        pangkatGolonganSelect.remove(1);
                    }

                    // Filter opsi berdasarkan status ASN
                    let optionsToShow = [];
                    if (selectedStatus === 'PNS') {
                        // Tampilkan hanya opsi PNS
                        optionsToShow = allOptionsData.filter(opt => pnsOptions.includes(opt.value));
                    } else if (selectedStatus === 'PPPK') {
                        // Tampilkan opsi PPPK
                        optionsToShow = allOptionsData.filter(opt => opt.value.startsWith('PPPK Gol.'));
                    } else if (selectedStatus === 'Non ASN') {
                        // Tampilkan opsi Non ASN
                        optionsToShow = allOptionsData.filter(opt => opt.value === 'Non ASN');
                    } else {
                        // Tampilkan semua opsi jika belum dipilih
                        optionsToShow = allOptionsData.filter(opt => opt.value !== '');
                    }

                    // Tambahkan opsi yang difilter
                    optionsToShow.forEach(optData => {
                        const option = document.createElement('option');
                        option.value = optData.value;
                        option.textContent = optData.text;
                        pangkatGolonganSelect.appendChild(option);
                    });

                    // Set value kembali jika masih valid, jika tidak reset
                    if (currentValue && Array.from(pangkatGolonganSelect.options).some(opt => opt.value === currentValue)) {
                        pangkatGolonganSelect.value = currentValue;
                    } else {
                        pangkatGolonganSelect.value = '';
                    }
                }

                // Event listener untuk perubahan status ASN
                statusAsnSelect.addEventListener('change', filterPangkatGolongan);

                // Panggil fungsi saat halaman pertama kali dimuat
                filterPangkatGolongan();
            }
         });
     </script>
     <script src="{{ url_for('static', filename='js/sweetalert-flash.js') }}"></script>
    <script>
     // Konfirmasi sebelum submit form edit biodata
        (function() {
            const form = document.getElementById('editBiodataForm');
            let isSubmitting = false;

            if (form) {
                const submitHandler = function(e) {
                    // Prevent multiple submissions
                    if (isSubmitting) {
                        e.preventDefault();
                        return false;
                    }

                    // Prevent default submission untuk validasi
                    e.preventDefault();
                    isSubmitting = true;

                    // Ambil data dari form
                    const namaLengkap = document.getElementById('nama_lengkap')?.value || '';
                    const nik = document.getElementById('NIK')?.value || '';
                    const namaKegiatanSelect = document.getElementById('nama_kegiatan');
                    const namaKegiatan = namaKegiatanSelect ? namaKegiatanSelect.options[namaKegiatanSelect.selectedIndex].text : '';

                    // Validasi dasar
                    if (!namaLengkap || !nik || !namaKegiatan) {
                        isSubmitting = false;
                        Swal.fire({
                            title: 'Data Belum Lengkap',
                            text: 'Mohon lengkapi semua field yang wajib diisi.',
                            icon: 'warning',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#067ac1'
                        });
                        return;
                    }

                    // Build HTML message untuk SweetAlert dengan format rapi
                    let confirmHtml = 'Apakah Anda yakin ingin menyimpan perubahan data biodata ini?<br><br>';
                    confirmHtml += '<div style="text-align: left; margin: 0 auto; display: inline-block;">';

                    if (namaLengkap) {
                        confirmHtml += `<div style="margin-bottom: 8px;"><span style="display: inline-block; width: 120px; font-weight: bold;">Nama Lengkap</span><span style="margin-right: 8px;"> :</span>${escapeHtml(namaLengkap)}</div>`;
                    }
                    if (nik) {
                        confirmHtml += `<div style="margin-bottom: 8px;"><span style="display: inline-block; width: 120px; font-weight: bold;">NIK</span><span style="margin-right: 8px;"> :</span>${escapeHtml(nik)}</div>`;
                    }
                    if (namaKegiatan) {
                        confirmHtml += `<div style="margin-bottom: 8px;"><span style="display: inline-block; width: 120px; font-weight: bold;">Kegiatan</span><span style="margin-right: 8px;"> :</span>${escapeHtml(namaKegiatan)}</div>`;
                    }

                    confirmHtml += '</div>';
                    confirmHtml += '<br><span style="color: #059669;"><strong>Pastikan semua data sudah benar.</strong></span>';

                    Swal.fire({
                        title: 'Simpan Perubahan?',
                        html: confirmHtml,
                        showCancelButton: true,
                        confirmButtonColor: '#059669',
                        cancelButtonColor: '#6b7280',
                        confirmButtonText: 'Ya, Simpan',
                        cancelButtonText: 'Batal',
                        reverseButtons: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // User klik Ya, Simpan - lanjutkan submit
                            form.removeEventListener('submit', submitHandler);
                            form.submit();
                        } else {
                            // User klik Batal - batalkan submit dan reset isSubmitting
                            isSubmitting = false;
                        }
                    });
                };

                form.addEventListener('submit', submitHandler);
            }

            // Fungsi untuk escape HTML (prevent XSS)
            function escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return String(text).replace(/[&<>"']/g, function(m) { return map[m]; });
            }
        })();
    </script>
</body>
</html>

